<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>QualityControl: Advanced topics</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QualityControl
   &#160;<span id="projectnumber">1.5.1</span>
   </div>
   <div id="projectbrief">O2 Data Quality Control Framework</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md_doc_Advanced.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Advanced topics </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a href="#advanced-topics">Advanced topics</a><ul>
<li><a href="#plugging-the-qc-to-an-existing-dpl-workflow">Plugging the QC to an existing DPL workflow</a></li>
<li><a href="#production-of-qc-objects-outside-this-framework">Production of QC objects outside this framework</a><ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#example-1-basic">Example 1: basic</a></li>
<li><a href="#example-2-advanced">Example 2: advanced</a></li>
<li><a href="#limitations">Limitations</a></li>
</ul>
</li>
<li><a href="#multi-node-setups">Multi-node setups</a></li>
<li><a href="#writing-a-dpl-data-producer">Writing a DPL data producer</a></li>
<li><a href="#access-run-conditions-and-calibrations-from-the-ccdb">Access run conditions and calibrations from the CCDB</a></li>
<li><a href="#definition-and-access-of-task-specific-configuration">Definition and access of task-specific configuration</a></li>
<li><a href="#custom-qc-object-metadata">Custom QC object metadata</a></li>
<li><a href="#canvas-options">Canvas options</a></li>
<li><a href="#data-inspector">Data Inspector</a><ul>
<li><a href="#prerequisite">Prerequisite</a></li>
<li><a href="#compilation">Compilation</a></li>
<li><a href="#execution">Execution</a></li>
<li><a href="#configuration-1">Configuration</a></li>
</ul>
</li>
<li><a href="#details-on-the-data-storage-format-in-the-ccdb">Details on the data storage format in the CCDB</a><ul>
<li><a href="#data-storage-format-before-v014-and-root-618">Data storage format before v0.14 and ROOT 6.18</a></li>
</ul>
</li>
<li><a href="#local-ccdb-setup">Local CCDB setup</a></li>
<li><a href="#local-qcg-qc-gui-setup">Local QCG (QC GUI) setup</a></li>
<li><a href="#developing-qc-modules-on-a-machine-with-flp-suite">Developing QC modules on a machine with FLP suite</a></li>
<li><a href="#use-mysql-as-qc-backend">Use MySQL as QC backend</a></li>
<li><a href="#configuration-files-details">Configuration files details</a><ul>
<li><a href="#global-configuration-structure">Global configuration structure</a></li>
<li><a href="#common-configuration">Common configuration</a></li>
<li><a href="#qc-tasks-configuration">QC Tasks configuration</a></li>
<li><a href="#qc-checks-configuration">QC Checks configuration</a></li>
<li><a href="#qc-aggregators-configuration">QC Aggregators configuration</a></li>
<li><a href="#qc-post-processing-configuration">QC Post-processing configuration</a></li>
<li><a href="#external-tasks-configuration">External tasks configuration</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>← Go back to Post-processing | ../README.md "↑ Go to the Table of Content ↑" | Continue to Frequently Asked Questions →</p>
<h2>Plugging the QC to an existing DPL workflow</h2>
<p>Your existing DPL workflow can simply be considered a publisher. Therefore, replace <code>o2-qc-run-producer</code> with your own workflow.</p>
<p>For example, if TPC wants to monitor the output <code>{"TPC", "CLUSTERS"}</code> of the workflow <code>o2-qc-run-tpcpid</code>, modify the config file to point to the correct data and do : </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;o2-qc-run-tpcpid | o2-qc --config json://${QUALITYCONTROL_ROOT}/etc/tpcQCPID.json</div></div><!-- fragment --><h2>Production of QC objects outside this framework</h2>
<p>QC objects (e.g. histograms) are typically produced in a QC task. This is however not the only way. Some processing tasks such as the calibration might have already processed the data and produced histograms that should be monitored. Instead of re-processing and doing twice the work, one can simply push this QC object to the QC framework where it will be checked and stored.</p>
<h3>Configuration</h3>
<p>Let be a device in the main data flow that produces a histogram on a channel defined as <code>TST/HISTO/0</code>. To get this histogram in the QC and check it, add to the configuration file an "external device": </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&quot;externalTasks&quot;: {</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;External-1&quot;: {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;active&quot;: &quot;true&quot;,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &quot;query&quot;: &quot;External-1:TST/HISTO/0&quot;,  &quot;&quot;: &quot;Query specifying where the objects to be checked and stored are coming from. Use the task name as binding. The origin (e.g. TST) is used as detector name for the objects.&quot;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  }</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;},</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&quot;checks&quot;: {</div></div><!-- fragment --><p> The "query" syntax is the same as the one used in the DPL and in the Dispatcher. It must match the output of another device, whether it is in the same workflow or in a piped one. The <code>binding</code> (first part, before the colon) is used in the path of the stored objects and thus we encourage to use the task name to avoid confusion. Moreover, the <code>origin</code> (first element after the colon) is used as detectorName.</p>
<h3>Example 1: basic</h3>
<p>As a basic example, we are going to produce histograms with the HistoProducer and collect them with the QC. The configuration is in <a href="https://github.com/AliceO2Group/AliceO2/tree/dev/Framework/basic-external-histo.json">basic-external-histo.json</a>. An external task is defined and named "External-1" (see subsection above). It is then used in the Check QCCheck : </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&quot;QcCheck&quot;: {</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;active&quot;: &quot;true&quot;,</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &quot;className&quot;: &quot;o2::quality_control_modules::skeleton::SkeletonCheck&quot;,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  &quot;moduleName&quot;: &quot;QcSkeleton&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  &quot;policy&quot;: &quot;OnAny&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;  &quot;detectorName&quot;: &quot;TST&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;  &quot;dataSource&quot;: [{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    &quot;type&quot;: &quot;ExternalTask&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &quot;name&quot;: &quot;External-1&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    &quot;MOs&quot;: [&quot;hello&quot;]</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;  }]</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;}</div></div><!-- fragment --><p> When using this feature, make sure that the name of the MO in the Check definition matches the name of the object you are sending from the external device.</p>
<p>To run it, do: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;o2-qc-run-histo-producer | o2-qc --config  json://${QUALITYCONTROL_ROOT}/etc/basic-external-histo.json</div></div><!-- fragment --><p>The object is visible in the QCG or the CCDB at <code>qc/TST/MO/External-1/hello_0</code>. In general we publish the objects of an external device at <code>qc/&lt;detector&gt;/MO/&lt;binding&gt;/object</code>.</p>
<p>The check results are stored at <code>qc/&lt;detector&gt;/QO/&lt;binding&gt;/object</code>.</p>
<h3>Example 2: advanced</h3>
<p>This second, more advanced, example mixes QC tasks and external tasks. It is defined in <a href="https://github.com/AliceO2Group/AliceO2/tree/dev/Framework/advanced-external-histo.json">advanced-external-histo.json</a>. It is represented here:</p>
<div class="image">
<img src="images/Advanced-external.png"  alt="alt text"/>
</div>
<p>First, it runs 1 QC task (QC-TASK-RUNNER-QcTask) getting data from a data producer (bottom boxes, typical QC worfklow).</p>
<p>On top we see 3 histogram producers. <code>histoProducer-2</code> is not part of the QC, it is not an external device defined in the configuration file. The two other histogram producers are configured as external devices in the configuration file.</p>
<p><code>histoProducer-0</code> produces an object that is used in a check (<code>QcCheck-External-1</code>). <code>histoProducer-1</code> objects are not used in any check but we generate one automatically to take care of the storage in the database.</p>
<p>To run it, do: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;o2-qc-run-producer | o2-qc-run-histo-producer --producers 3 --histograms 3 | o2-qc --config  json://${QUALITYCONTROL_ROOT}/etc/advanced-external-histo.json </div></div><!-- fragment --><h3>Limitations</h3>
<ol type="1">
<li>Objects sent by the external device must be either a <a class="el" href="classTObject.html">TObject</a> or a <a class="el" href="classTObjArray.html">TObjArray</a>. In the former case, the object will be sent to the checker encapsulated in a MonitorObject. In the latter case, each <a class="el" href="classTObject.html">TObject</a> of the <a class="el" href="classTObjArray.html">TObjArray</a> is encapsulated in a MonitorObject and is sent to the checker.</li>
</ol>
<h2>Multi-node setups</h2>
<p>During the data-taking Quality Control runs on a distributed computing system. Some QC Tasks are executed on dedicated QC servers, while others run on FLPs and EPNs. In the first case, messages coming from Data Sampling should reach QC servers where they are processed. In the latter case, locally produced Monitor Objects should be merged on QC servers and then have Checks run on them. By <b>remote QC tasks</b> we mean those which run on QC servers (<b>remote machines</b>), while <b>local QC Tasks</b> run on FLPs and EPNs (<b>local machines</b>).</p>
<p>While it is responsibility of the run operators to run all the processing topologies during the data taking, here we show how to achieve such multinode workflows on development setups, running them just with DPL driver. Note that for now we support cases with one or more local machines, but just only one remote machine.</p>
<p>In our example, we assume having two local processing nodes (<code>localnode1</code>, <code>localnode2</code>) and one QC node (<code>qcnode</code>). There are two types of QC Tasks declared:</p><ul>
<li><code>MultiNodeLocal</code> which are executed on the local nodes and their results are merged and checked on the QC server.</li>
<li><code>MultiNodeRemote</code> which runs on the QC server, receiving a small percent of data from <code>localnode2</code> only. Mergers are not needed in this case, but there is a process running Checks against Monitor Objects generated by this Task.</li>
</ul>
<p>We use the <code>SkeletonTask</code> class for both, but any Task can be used of course. Should a Task be local, all its <code>MonitorObject</code>s need to be mergeable - they should be one of the mergeable ROOT types (histograms, TTrees) or inherit <a href="https://github.com/AliceO2Group/AliceO2/blob/dev/Utilities/Mergers/include/Mergers/MergeInterface.h">MergeInterface</a>.</p>
<p>These are the steps to follow to get a multinode setup:</p>
<ol type="1">
<li>Prepare a configuration file.</li>
</ol>
<p>In this example we will use the <code>Framework/multiNode.json</code> config file. A config file should look almost like the usual one, but with a few additional parameters. In case of a local task, these parameters should be added:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&quot;tasks&quot;: {</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;MultiNodeLocal&quot;: {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;active&quot;: &quot;true&quot;,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    ...</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &quot;location&quot;: &quot;local&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &quot;localMachines&quot;: [</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &quot;localnode1&quot;,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &quot;localnode2&quot;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    ],</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    &quot;remoteMachine&quot;: &quot;qcnode&quot;,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &quot;remotePort&quot;: &quot;30132&quot;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &quot;mergingMode&quot;: &quot;delta&quot;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  }</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;},</div></div><!-- fragment --><p> List the local processing machines in the <code>localMachines</code> array. <code>remoteMachine</code> should contain the host name which will serve as a QC server and <code>remotePort</code> should be a port number on which Mergers will wait for upcoming MOs. Make sure it is not used by other service. If different QC Tasks are run in parallel, use separate ports for each. One also may choose the merging mode - <code>delta</code> is the default and recommended (tasks are reset after each cycle, so they send only updates), but if it is not feasible, Mergers may expect <code>entire</code> objects - tasks are not reset, they always send entire objects and the latest versions are combined in Mergers.</p>
<p>In case of a remote task, choosing <code>"remote"</code> option for the <code>"location"</code> parameter is enough.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&quot;tasks&quot;: {</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  ...</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  &quot;MultiNodeRemote&quot;: {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &quot;active&quot;: &quot;true&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    ...</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &quot;dataSource&quot;: {</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &quot;type&quot;: &quot;dataSamplingPolicy&quot;,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;      &quot;name&quot;: &quot;rnd-little&quot;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    },</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    &quot;taskParameters&quot;: {},</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    &quot;location&quot;: &quot;remote&quot;</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;  }</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;}</div></div><!-- fragment --><p>However in both cases, one has to specify the machines where data should be sampled, as below. If data should be published to external machines (with remote tasks), one has to add a local port number. Use separate ports for each Data Sampling Policy. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;dataSamplingPolicies&quot;: [</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    ...</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    {</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      &quot;id&quot;: &quot;rnd-little&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;      &quot;active&quot;: &quot;true&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      &quot;machines&quot;: [</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &quot;localnode2&quot;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;      ],</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      &quot;port&quot;: &quot;30333&quot;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      ...</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    }</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;  ]</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;}</div></div><!-- fragment --><p> /</p><ol type="1">
<li>Make sure that the firewalls are properly configured. If your machines block incoming/outgoing connections by default, you can add these rules to the firewall (run as sudo). Consider enabling only concrete ports or a small range of those.</li>
</ol>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# localnode1 and localnode2 :</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;iptables -I INPUT -p tcp -m conntrack --ctstate NEW,ESTABLISHED -s qcnode -j ACCEPT</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;iptables -I OUTPUT -p tcp -m conntrack --ctstate NEW,ESTABLISHED -d qcnode -j ACCEPT</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;# qcnode:</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;iptables -I INPUT -p tcp -m conntrack --ctstate NEW,ESTABLISHED -s localnode1 -j ACCEPT</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;iptables -I OUTPUT -p tcp -m conntrack --ctstate NEW,ESTABLISHED -d localnode1 -j ACCEPT</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;iptables -I INPUT -p tcp -m conntrack --ctstate NEW,ESTABLISHED -s localnode2 -j ACCEPT</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;iptables -I OUTPUT -p tcp -m conntrack --ctstate NEW,ESTABLISHED -d localnode2 -j ACCEPT</div></div><!-- fragment --><ol type="1">
<li>Install the same version of the QC software on each of these nodes. We cannot guarantee that different QC versions will talk to each other without problems. Also, make sure the configuration file that you will use is the same everywhere.</li>
<li>Run each part of the workflow. In this example <code>o2-qc-run-producer</code> represents any DPL workflow, here it is just a process which produces some random data. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# On localnode1:</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;o2-qc-run-producer | o2-qc --config json:/${QUALITYCONTROL_ROOT}/etc/multiNode.json --local --host localnode1 -b</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;# On localnode2:</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;o2-qc-run-producer | o2-qc --config json:/${QUALITYCONTROL_ROOT}/etc/multiNode.json --local --host localnode2 -b</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;# On qcnode:</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;o2-qc --config json:/${QUALITYCONTROL_ROOT}/etc/multiNode.json --remote</div></div><!-- fragment --></li>
</ol>
<p>If there are no problems, on QCG you should see the <code>example</code> histogram updated under the paths <code>qc/TST/MO/MultiNodeLocal</code> and <code>qc/TST/MO/MultiNodeRemote</code>, and corresponding Checks under the path <code>qc/TST/QO/</code>.</p>
<h2>Writing a DPL data producer</h2>
<p>For your convenience, and although it does not lie within the QC scope, we would like to document how to write a simple data producer in the DPL. The DPL documentation can be found https://github.com/AliceO2Group/AliceO2/blob/dev/Framework/Core/README.md "here" and for questions please head to the <a href="https://alice-talk.web.cern.ch/">forum</a>.</p>
<p>As an example we take the <code>DataProducerExample</code> that you can find in the QC repository. It is produces a number. By default it will be 1s but one can specify with the parameter <code>my-param</code> a different number. It is made of 3 files :</p><ul>
<li><a href="../Framework/src/runDataProducerExample.cxx">runDataProducerExample.cxx</a> : This is an executable with a basic data producer in the Data Processing Layer. There are 2 important functions here :<ul>
<li><code>customize(...)</code> to add parameters to the executable. Note that it must be written before the includes for the dataProcessing.</li>
<li><code>defineDataProcessing(...)</code> to define the workflow to be ran, in our case the device(s) publishing the number.</li>
</ul>
</li>
<li><a href="../Framework/include/QualityControl/DataProducerExample.h">DataProducerExample.h</a> : The key elements are :<ol type="1">
<li>The include <code>#include &lt;Framework/DataProcessorSpec.h&gt;</code></li>
<li>The function <code>getDataProducerExampleSpec(...)</code> which must return a <code>DataProcessorSpec</code> i.e. the description of a device (name, inputs, outputs, algorithm)</li>
<li>The function <code>getDataProducerExampleAlgorithm</code> which must return an <code>AlgorithmSpec</code> i.e. the actual algorithm that produces the data.</li>
</ol>
</li>
<li><a href="../Framework/src/DataProducerExample.cxx">DataProducerExample.cxx</a> : This is just the implementation of the header described just above. You will probably want to modify <code>getDataProducerExampleSpec</code> and the inner-most block of <code>getDataProducerExampleAlgorithm</code>. You might be taken aback by the look of this function, if you don't know what a <em>lambda</em> is just ignore it and write your code inside the accolades.</li>
</ul>
<p>You will probably write it in your detector's O2 directory rather than in the QC repository.</p>
<h2>Access run conditions and calibrations from the CCDB</h2>
<p>The MonitorObjects generated by Quality Control are stored in a dedicated repository based on CCDB. The run conditions, on the other hand, are located in another, separate database. One can access these conditions inside a Task by a dedicated method of the TaskInterface, as below: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;TObject* condition = TaskInterface::retrieveCondition(&quot;Path/to/condition&quot;);</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;if (condition) {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  LOG(INFO) &lt;&lt; &quot;Retrieved &quot; &lt;&lt; condition-&gt;ClassName();</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;  delete condition;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;}</div></div><!-- fragment --><p> Make sure to declare a valid URL of CCDB in the config file. Keep in mind that it might be different from the CCDB instance used for storing QC objects.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;qc&quot;: {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;config&quot;: {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;     ...</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;      &quot;conditionDB&quot;: {</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &quot;url&quot;: &quot;ccdb-test.cern.ch:8080&quot;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      }</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    },</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    ...</div></div><!-- fragment --><h2>Definition and access of task-specific configuration</h2>
<p>A task can access custom parameters declared in the configuration file at <code>qc.tasks.&lt;task_name&gt;.taskParameters</code>. They are stored inside a key-value map named mCustomParameters, which is a protected member of <code>TaskInterface</code>.</p>
<p>One can also tell the DPL driver to accept new arguments. This is done using the <code>customize</code> method at the top of your workflow definition (usually called "runXXX" in the QC).</p>
<p>For example, to add two parameters of different types do : </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;void customize(std::vector&lt;ConfigParamSpec&gt;&amp; workflowOptions)</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  workflowOptions.push_back(</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    ConfigParamSpec{ &quot;config-path&quot;, VariantType::String, &quot;&quot;, { &quot;Path to the config file. Overwrite the default paths. Do not use with no-data-sampling.&quot; } });</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;  workflowOptions.push_back(</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    ConfigParamSpec{ &quot;no-data-sampling&quot;, VariantType::Bool, false, { &quot;Skips data sampling, connects directly the task to the producer.&quot; } });</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;}</div></div><!-- fragment --><h2>Custom QC object metadata</h2>
<p>One can add custom metadata on the QC objects produced in a QC task. Simply call <code>ObjectsManager::addMetadata(...)</code>, like in </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;// add a metadata on histogram mHistogram, key is &quot;custom&quot; and value &quot;34&quot;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;getObjectsManager()-&gt;addMetadata(mHistogram-&gt;GetName(), &quot;custom&quot;, &quot;34&quot;);</div></div><!-- fragment --><p> This metadata will end up in the QCDB.</p>
<h2>Canvas options</h2>
<p>The developer of a Task might perfectly know how to display a plot or a graph but cannot set these options if they belong to the Canvas. This is typically the case of <code>drawOptions</code> such as <code>colz</code> or <code>alp</code>. It is also the case for canvases' properties such as logarithmic scale and grid. These options can be set by the end user in the QCG but it is likely that the developer wants to give pertinent default options.</p>
<p>To do so, one can use one of the two following methods.</p><ul>
<li><p class="startli"><code>TObjectsManager::setDefaultDrawOptions(&lt;objectname or pointer&gt;, string&amp; drawOptions)</code></p>
<p class="startli"><code>drawOptions</code> is a space-separated list of drawing options. E.g. "colz" or "alp lego1".</p>
</li>
<li><p class="startli"><code>TObjectsManager::setDisplayHint(&lt;objectname or pointer&gt;, string&amp; hints)</code></p>
<p class="startli"><code>hints</code> is a space-separated list of hints on how to draw the object. E.g. "logz" or "gridy logy".</p>
<p class="startli">Currently supported by QCG: logx, logy, logz, gridx, gridy, gridz.</p>
</li>
</ul>
<h2>Data Inspector</h2>
<p>This is a GUI to inspect the data coming out of the DataSampling, in particular the Readout.</p>
<div class="image">
<img src="images/dataDump.png"  alt="alt text"/>
</div>
<h3>Prerequisite</h3>
<p>If not already done, install GLFW for your platform. On CC7 install <code>glfw-devel</code> from epel repository : <code>sudo yum install glfw-devel --enablerepo=epel</code></p>
<h3>Compilation</h3>
<p>Build the QualityControl as usual.</p>
<h3>Execution</h3>
<p>To monitor the readout, 3 processes have to be started : the Readout, the Data Sampling and the Data Inspector.</p>
<p>First make sure that the Data Sampling is enabled in the readout : </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;[consumer-fmq-qc]</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;consumerType=FairMQChannel</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;enableRawFormat=1</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;fmq-name=readout-qc</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;fmq-address=ipc:///tmp/readout-pipe-1</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;fmq-type=pub</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;fmq-transport=zeromq</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;unmanagedMemorySize=2G</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;memoryPoolNumberOfPages=500</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;memoryPoolPageSize=1M</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;enabled=1</div></div><!-- fragment --><p>In 3 separate terminals, do respectively</p>
<ol type="1">
<li><code>readout.exe <a href="file:///absolute/path/to/config.cfg">file:///absolute/path/to/config.cfg</a></code></li>
<li><code>o2-qc-run-readout-for-data-dump --batch</code></li>
<li><code>o2-qc-data-dump --mq-config $QUALITYCONTROL_ROOT/etc/dataDump.json --id dataDump --control static</code></li>
</ol>
<h3>Configuration</h3>
<p><b>Fraction of data</b> The Data Sampling tries to take 100% of the events by default. Edit <code>$QUALITYCONTROL_ROOT/etc/readoutForDataDump.json</code> to change it. Look for the parameter <code>fraction</code> that is set to 1.</p>
<p><b>Port</b> The Data Sampling sends data to the GUI via the port <code>26525</code>. If this port is not free, edit the config file <code>$QUALITYCONTROL_ROOT/etc/readoutForDataDump.json</code> and <code>$QUALITYCONTROL_ROOT/etc/dataDump.json</code>.</p>
<h2>Details on the data storage format in the CCDB</h2>
<p>Each MonitorObject is stored as a TFile in the CCDB. It is therefore possible to easily open it with ROOT when loaded with alienv. It also seamlessly supports class schema evolution.</p>
<p>The MonitorObjects are stored at a path which is enforced by the qc framework : <code>/qc/&lt;detector code&gt;/MO/&lt;task name&gt;/object/name</code> Note that the name of the object can contain slashes (<code>/</code>) in order to build a sub-tree visible in the GUI. The detector name and the taskname are set in the config file : </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&quot;tasks&quot;: {</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;QcTask&quot;: {       &lt;---------- task name</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;active&quot;: &quot;true&quot;,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &quot;className&quot;: &quot;o2::quality_control_modules::skeleton::SkeletonTask&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &quot;moduleName&quot;: &quot;QcSkeleton&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &quot;detectorName&quot;: &quot;TST&quot;,       &lt;---------- detector name</div></div><!-- fragment --><p>The quality is stored as a CCDB metadata of the object.</p>
<h3>Data storage format before v0.14 and ROOT 6.18</h3>
<p>Before September 2019, objects were serialized with TMessage and stored as <em>blobs</em> in the CCDB. The main drawback was the loss of the corresponding streamer infos leading to problems when the class evolved or when accessing the data outside the QC framework.</p>
<p>The QC framework is nevertheless backward compatible and can handle the old and the new storage system.</p>
<h2>Local CCDB setup</h2>
<p>Having a central ccdb for test (ccdb-test) is handy but also means that everyone can access, modify or delete the data. If you prefer to have a local instance of the CCDB, for example in your lab or on your development machine, follow these instructions.</p>
<ol type="1">
<li>Download the local repository service from <a href="http://alimonitor.cern.ch/download/local.jar">http://alimonitor.cern.ch/download/local.jar</a></li>
<li>The service can simply be run with <code>java -jar local.jar</code></li>
</ol>
<p>It will start listening by default on port 8080. This can be changed either with the java parameter “tomcat.port” or with the environment variable “TOMCAT_PORT”. Similarly the default listening address is 127.0.0.1 and it can be changed with the java parameter “tomcat.address” or with the environment variable “TOMCAT_ADDRESS” to something else (for example ‘*’ to listen on all interfaces).</p>
<p>By default the local repository is located in /tmp/QC (or java.io.tmpdir/QC to be more precise). You can change this location in a similar way by setting the java parameter “file.repository.location” or the environment variable “FILE_REPOSITORY_LOCATION”.</p>
<p>The address of the CCDB will have to be updated in the Tasks config file.</p>
<p>At the moment, the description of the REST api can be found in this document : <a href="https://docs.google.com/presentation/d/1PJ0CVW7QHgnFzi0LELc06V82LFGPgmG3vsmmuurPnUg">https://docs.google.com/presentation/d/1PJ0CVW7QHgnFzi0LELc06V82LFGPgmG3vsmmuurPnUg</a></p>
<h2>Local QCG (QC GUI) setup</h2>
<p>To install and run the QCG locally, and its fellow process tobject2json, please follow these instructions : <a href="https://github.com/AliceO2Group/WebUi/tree/dev/QualityControl#run-qcg-locally">https://github.com/AliceO2Group/WebUi/tree/dev/QualityControl#run-qcg-locally</a></p>
<h2>Developing QC modules on a machine with FLP suite</h2>
<p>To load a development library in a setup with FLP suite, specify its full path in the config file (e.g. <code>/etc/flp.d/qc/readout.json</code>): </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&quot;tasks&quot;: {</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;QcTask&quot;: {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;active&quot;: &quot;true&quot;,</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    &quot;className&quot;: &quot;o2::quality_control_modules::skeleton::SkeletonTask&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    &quot;moduleName&quot;: &quot;/home/myuser/alice/sw/BUILD/QualityControl-latest/QualityControl/libQcTstLibrary&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    ...</div></div><!-- fragment --><p> Make sure that:</p><ul>
<li>The name "QcTask" stays the same, as changing it might break the workflow specification for AliECS</li>
<li>The library is compiled with the same QC, O2, ROOT and GCC version as the ones which are installed with the FLP suite. Especially, the task and check interfaces have to be identical.</li>
</ul>
<h2>Use MySQL as QC backend</h2>
<p>WARNING. We do not actively support MySQL as QC database anymore. The interface might not work as expected anymore.</p>
<ol type="1">
<li>Install the MySQL/MariaDB development package<ul>
<li>CC7 : <code>sudo yum install mariadb-server</code></li>
<li>Mac (or download the dmg from Oracle) : <code>brew install mysql</code></li>
</ul>
</li>
<li>Rebuild the QualityControl (so that the mysql backend classes are compiled)</li>
<li>Start and populate database :</li>
</ol>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sudo systemctl start mariadb # for CC7, check for your specific OS</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;alienv enter qcg/latest</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;o2-qc-database-setup.sh</div></div><!-- fragment --><h2>Configuration files details</h2>
<p>The QC requires a number of configuration items. An example config file is provided in the repo under the name <em>example-default.json</em>. This is a quick reference for all the parameters.</p>
<h3>Global configuration structure</h3>
<p>This is the global structure of the configuration in QC.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;qc&quot;: {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;config&quot;: {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    },</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    &quot;tasks&quot;: {</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    },</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    &quot;externalTasks&quot;: {</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;    },</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;    &quot;checks&quot;: {</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;    },</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;    &quot;postprocessing&quot;: {</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    }</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  },</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  &quot;dataSamplingPoliciesFile&quot;: &quot;json:///path/to/data/sampling/config.json&quot;,</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  &quot;dataSamplingPolicies&quot;: [</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  ]</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;}</div></div><!-- fragment --><p>There are four QC-related components:</p><ul>
<li>"config" - contains global configuration of QC which apply to any component. It is required in any configuration file.</li>
<li>"tasks" - contains declarations of QC Tasks. It is mandatory for running topologies with Tasks and Checks.</li>
<li>"externalTasks" - contains declarations of external devices which sends objects to the QC to be checked and stored.</li>
<li>"checks" - contains declarations of QC Checks. It is mandatory for running topologies with Tasks and Checks.</li>
<li>"postprocessing" - contains declarations of PostProcessing Tasks. It is only needed only when Post-Processing is run.</li>
</ul>
<p>The configuration file can also include a path to Data Sampling configuration ("dataSamplingPoliciesFile") or the list of Data Sampling Policies. Please refer to the <a href="https://github.com/AliceO2Group/AliceO2/tree/dev/Framework/Core#data-sampling">Data Sampling documentation</a> to find more information.</p>
<h3>Common configuration</h3>
<p>This is how a typical "config" structure looks like. Each configuration element is described with a relevant comment afterwards. The <code>"": "\&lt;comment\&gt;",</code> formatting is to keep the JSON structure valid. Please note that these comments should not be present in real configuration files.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;qc&quot;: {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;config&quot;: {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &quot;database&quot;: {                       &quot;&quot;: &quot;Configuration of a QC database (the place where QC results are stored).&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        &quot;username&quot;: &quot;qc_user&quot;,            &quot;&quot;: &quot;Username to log into a DB. Relevant only to the MySQL implementation.&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &quot;password&quot;: &quot;qc_user&quot;,            &quot;&quot;: &quot;Password to log into a DB. Relevant only to the MySQL implementation.&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        &quot;name&quot;: &quot;quality_control&quot;,        &quot;&quot;: &quot;Name of a DB. Relevant only to the MySQL implementation.&quot;,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &quot;implementation&quot;: &quot;CCDB&quot;,         &quot;&quot;: &quot;Implementation of a DB. It can be CCDB, or MySQL (deprecated).&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        &quot;host&quot;: &quot;ccdb-test.cern.ch:8080&quot;, &quot;&quot;: &quot;URL of a DB.&quot;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;      },</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;      &quot;Activity&quot;: {                       &quot;&quot;: [&quot;Configuration of a QC Activity (Run). This structure is subject to&quot;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;                                               &quot;change or the values might come from other source (e.g. AliECS).&quot; ],</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;        &quot;number&quot;: &quot;42&quot;,                   &quot;&quot;: &quot;Activity number.&quot;,</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        &quot;type&quot;: &quot;2&quot;,                      &quot;&quot;: &quot;Arbitrary activity type.&quot;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;      },</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;      &quot;monitoring&quot;: {                     &quot;&quot;: &quot;Configuration of the Monitoring library.&quot;,</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        &quot;url&quot;: &quot;infologger:///debug?qc&quot;,  &quot;&quot;: [&quot;URI to the Monitoring backend. Refer to the link below for more info:&quot;,</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;                                               &quot;https://github.com/AliceO2Group/Monitoring#monitoring-instance&quot;]</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;      },</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;      &quot;consul&quot;: {                         &quot;&quot;: &quot;Configuration of the Consul library (used for Service Discovery).&quot;,</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        &quot;url&quot;: &quot;http://consul-test.cern.ch:8500&quot;, &quot;&quot;: &quot;URL of the Consul backend&quot;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;      },</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;      &quot;conditionDB&quot;: {                    &quot;&quot;: [&quot;Configuration of the Conditions and Calibration DataBase (CCDB).&quot;,</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;                                               &quot;Do not mistake with the CCDB which is used as QC repository.&quot;],</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        &quot;url&quot;: &quot;ccdb-test.cern.ch:8080&quot;,  &quot;&quot;: &quot;URL of a CCDB&quot;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;      }</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    }</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;  }</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;}</div></div><!-- fragment --><h3>QC Tasks configuration</h3>
<p>Below the full QC Task configuration structure is described. Note that more than one task might be declared inside in the "tasks" path.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;qc&quot;: {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;tasks&quot;: {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &quot;QcTaskName&quot;: {                       &quot;&quot;: &quot;Name of the QC Task. Less than 14 character names are preferred.&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        &quot;active&quot;: &quot;true&quot;,                   &quot;&quot;: &quot;Activation flag. If not \&quot;true\&quot;, the Task will not be created.&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &quot;className&quot;: &quot;namespace::of::Task&quot;, &quot;&quot;: &quot;Class name of the QC Task with full namespace.&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        &quot;moduleName&quot;: &quot;QcSkeleton&quot;,         &quot;&quot;: &quot;Library name. It can be found in CMakeLists of the detector module.&quot;,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &quot;detectorName&quot;: &quot;TST&quot;,              &quot;&quot;: &quot;3-letter code of the detector.&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        &quot;cycleDurationSeconds&quot;: &quot;10&quot;,       &quot;&quot;: &quot;Duration of one cycle (how often MonitorObjects are published).&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        &quot;maxNumberCycles&quot;: &quot;-1&quot;,            &quot;&quot;: &quot;Number of cycles to perform. Use -1 for infinite.&quot;,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        &quot;dataSource&quot;: {                     &quot;&quot;: &quot;Data source of the QC Task.&quot;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;          &quot;type&quot;: &quot;dataSamplingPolicy&quot;,     &quot;&quot;: &quot;Type of the data source, \&quot;dataSamplingPolicy\&quot; or \&quot;direct\&quot;.&quot;,</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;          &quot;name&quot;: &quot;tst-raw&quot;,                &quot;&quot;: &quot;Name of Data Sampling Policy. Only for \&quot;dataSamplingPolicy\&quot; source.&quot;,</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;          &quot;query&quot; : &quot;raw:TST/RAWDATA/0&quot;,    &quot;&quot;: &quot;Query of the data source. Only for \&quot;direct\&quot; source.&quot;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        },</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        &quot;taskParameters&quot;: {                 &quot;&quot;: &quot;User Task parameters which are then accessible as a key-value map.&quot;,</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;          &quot;myOwnKey&quot;: &quot;myOwnValue&quot;,         &quot;&quot;: &quot;An example of a key and a value. Nested structures are not supported&quot;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        },</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        &quot;location&quot;: &quot;local&quot;,                &quot;&quot;: [&quot;Location of the QC Task, it can be local or remote. Needed only for&quot;,</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;                                                 &quot;multi-node setups, not respected in standalone development setups.&quot;],</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;        &quot;localMachines&quot;: [                  &quot;&quot;, &quot;List of local machines where the QC task should run. Required only&quot;,</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;                                            &quot;&quot;, &quot;for multi-node setups.&quot;,</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;          &quot;o2flp1&quot;,                         &quot;&quot;, &quot;Hostname of a local machine.&quot;,</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;          &quot;o2flp2&quot;,                         &quot;&quot;, &quot;Hostname of a local machine.&quot;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        ],</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        &quot;remoteMachine&quot;: &quot;o2qc1&quot;,           &quot;&quot;: &quot;Remote QC machine hostname. Required ony for multi-node setups.&quot;,</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        &quot;remotePort&quot;: &quot;30432&quot;,              &quot;&quot;: &quot;Remote QC machine TCP port. Required ony for multi-node setups.&quot;,</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        &quot;mergingMode&quot;: &quot;delta&quot;,             &quot;&quot;: &quot;Merging mode, \&quot;delta\&quot; (default) or \&quot;entire\&quot; objects are expected&quot;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;      }</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    }</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  }</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;}</div></div><!-- fragment --><h3>QC Checks configuration</h3>
<p>Below the full QC Checks configuration structure is described. Note that more than one check might be declared inside in the "checks" path. Please also refer to <a href="doc/ModulesDevelopment.md#configuration">the Checks documentation</a> for more details.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;qc&quot;: {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;checks&quot;: {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &quot;MeanIsAbove&quot;: {                &quot;&quot;: &quot;Name of the Check. Less than 12 character names are preferred.&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        &quot;active&quot;: &quot;true&quot;,             &quot;&quot;: &quot;Activation flag. If not \&quot;true\&quot;, the Check will not be run.&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &quot;className&quot;: &quot;ns::of::Check&quot;, &quot;&quot;: &quot;Class name of the QC Check with full namespace.&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        &quot;moduleName&quot;: &quot;QcCommon&quot;,     &quot;&quot;: &quot;Library name. It can be found in CMakeLists of the detector module.&quot;,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &quot;detectorName&quot;: &quot;TST&quot;,        &quot;&quot;: &quot;3-letter code of the detector.&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        &quot;policy&quot;: &quot;OnAny&quot;,            &quot;&quot;: [&quot;Policy which determines when MOs should be checked. See the documentation&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;                                           &quot;of Checks for the list of available policies and their behaviour.&quot;],</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        &quot;dataSource&quot;: [{              &quot;&quot;: &quot;List of data source of the Check.&quot;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;          &quot;type&quot;: &quot;Task&quot;,             &quot;&quot;: &quot;Type of the data source, \&quot;Task\&quot;, \&quot;ExternalTask\&quot; or \&quot;PostProcessing\&quot;&quot;, </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;          &quot;name&quot;: &quot;myTask_1&quot;,         &quot;&quot;: &quot;Name of the Task&quot;,</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;          &quot;MOs&quot;: [ &quot;example&quot; ],       &quot;&quot;: [&quot;List of MOs to be checked. &quot;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;                                            &quot;Can be omitted to mean \&quot;all\&quot;.&quot;]</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;        }],</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        &quot;checkParameters&quot;: {          &quot;&quot;: &quot;User Check parameters which are then accessible as a key-value map.&quot;,</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;          &quot;myOwnKey&quot;: &quot;myOwnValue&quot;,   &quot;&quot;: &quot;An example of a key and a value. Nested structures are not supported&quot;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        }</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;      }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    }</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;  }</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;}</div></div><!-- fragment --><h3>QC Aggregators configuration</h3>
<p>Below the full QC Aggregators configuration structure is described. Note that more than one aggregator might be declared inside in the "aggregators" path. Please also refer to <a href="doc/ModulesDevelopment.md#quality-aggregation">the Aggregators documentation</a> for more details.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;qc&quot;: {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;aggregators&quot;: {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &quot;MyAggregator1&quot;: {              &quot;&quot;: &quot;Name of the Aggregator. Less than 12 character names are preferred.&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        &quot;active&quot;: &quot;true&quot;,             &quot;&quot;: &quot;Activation flag. If not \&quot;true\&quot;, the Aggregator will not be run.&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &quot;className&quot;: &quot;ns::of::Aggregator&quot;, &quot;&quot;: &quot;Class name of the QC Aggregator with full namespace.&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        &quot;moduleName&quot;: &quot;QcCommon&quot;,     &quot;&quot;: &quot;Library name. It can be found in CMakeLists of the detector module.&quot;,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &quot;policy&quot;: &quot;OnAny&quot;,            &quot;&quot;: [&quot;Policy which determines when QOs should be aggregated. See the documentation&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;                                           &quot;of Aggregators for the list of available policies and their behaviour.&quot;],</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;        &quot;detectorName&quot;: &quot;TST&quot;,        &quot;&quot;: &quot;3-letter code of the detector.&quot;,</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        &quot;dataSource&quot;: [{              &quot;&quot;: &quot;List of data source of the Aggregator.&quot;,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;          &quot;type&quot;: &quot;Check&quot;,,           &quot;&quot;: &quot;Type of the data source: \&quot;Check\&quot; or \&quot;Aggregator\&quot;&quot;, </div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;          &quot;name&quot;: &quot;dataSizeCheck&quot;,    &quot;&quot;: &quot;Name of the Check or Aggregator&quot;,</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;          &quot;QOs&quot;: [&quot;newQuality&quot;, &quot;another&quot;], &quot;&quot;: [&quot;List of QOs to be checked.&quot;,</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;                                          &quot;Can be omitted for Checks&quot;, </div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;                                          &quot;that publish a single Quality or to mean \&quot;all\&quot;.&quot;]</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        }]</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;      }</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    }</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;}</div></div><!-- fragment --><h3>QC Post-processing configuration</h3>
<p>Below the full QC Post-processing (PP) configuration structure is described. Note that more than one PP Task might be declared inside in the "postprocessing" path. Please also refer to <a class="el" href="md_doc_PostProcessing.html">the Post-processing documentation</a> for more details.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;qc&quot;: {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;postprocessing&quot;: {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &quot;ExamplePostprocessing&quot;: {              &quot;&quot;: &quot;Name of the PP Task.&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        &quot;active&quot;: &quot;true&quot;,                     &quot;&quot;: &quot;Activation flag. If not \&quot;true\&quot;, the PP Task will not be run.&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &quot;className&quot;: &quot;namespace::of::PPTask&quot;, &quot;&quot;: &quot;Class name of the PP Task with full namespace.&quot;,</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;        &quot;moduleName&quot;: &quot;QcSkeleton&quot;,           &quot;&quot;: &quot;Library name. It can be found in CMakeLists of the detector module.&quot;,</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;        &quot;detectorName&quot;: &quot;TST&quot;,                &quot;&quot;: &quot;3-letter code of the detector.&quot;,</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;        &quot;initTrigger&quot;: [                      &quot;&quot;, &quot;List of initialization triggers&quot;,</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;          &quot;startofrun&quot;,                       &quot;&quot;, &quot;An example of an init trigger&quot;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        ],</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        &quot;updateTrigger&quot;: [                    &quot;&quot;, &quot;List of update triggers&quot;,</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;          &quot;10min&quot;,                            &quot;&quot;, &quot;An example of an update trigger&quot;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;        ],</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        &quot;stopTrigger&quot;: [                      &quot;&quot;, &quot;List of stop triggers&quot;,</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;          &quot;endofrun&quot;,                         &quot;&quot;, &quot;An example of a stop trigger&quot;</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        ]</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;      }</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;    }</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;  }</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;}</div></div><!-- fragment --><h3>External tasks configuration</h3>
<p>Below the external task configuration structure is described. Note that more than one external task might be declared inside in the "externalTasks" path.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  &quot;qc&quot;: {</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    &quot;externalTasks&quot;: {</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;      &quot;External-1&quot;: {                       &quot;&quot;: &quot;Name of the task&quot;,</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;        &quot;active&quot;: &quot;true&quot;,                   &quot;&quot;: &quot;Activation flag. If not \&quot;true\&quot;, the Task will not be created.&quot;,</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;        &quot;query&quot;: &quot;External-1:TST/HISTO/0&quot;,  &quot;&quot;: &quot;Query specifying where the objects to be checked and stored are coming from. Use the task name as binding.&quot;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;      }</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    }</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;  }</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;}</div></div><!-- fragment --> <hr/>
<p>← Go back to Post-processing | ../README.md "↑ Go to the Table of Content ↑" | Continue to Frequently Asked Questions → </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
