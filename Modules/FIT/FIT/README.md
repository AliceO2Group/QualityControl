# FIT quality control

## Checks

### MIPCheck

The `MIPCheck` checks peaks in channel amplitude spectra. Essentially it is a check on parameters of Gaussian fits of the MIP peaks.

#### Check parameters

The parameters of the check are listed in the table below. For all parameters that take a list as argument, the items in the list corresponds to the different peaks; the first item is for the 1 MIP peak and so on.
If a threshold argument is omitted, that threshold will not be checked. This way, it is also possible to disable checks for a threshold for only some of the peaks. To disable a check for the first peak, but keep it for subsequent peaks, a negative value will also disable a check.

| Name                   | Type             | Default value             | Comments                                                                                                                                                                                                                                                                                                                          |
|------------------------|------------------|---------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| `nameObjectToCheck`    | `string`         | `""`                      | Name of the MO to check                                                                                                                                                                                                                                                                                                           |
| `nPeaksToFit`          | `integer`        | `2`                       | Number of MIP peaks to fit. The resulting fit funcion is a sum of `nPeaksToFit` Gaussians.                                                                                                                                                                                                                                        |
| `gausParamsMeans`      | list of `float`  | `""`                      | Initial fit paramemters for the gaussian means. If omitted, the 1 MIP peak will default to the amplitude at the ampltude histogram max value. Other peaks  will default to multiples of the initial 1 MIP peak mean (2 MIP peak mean = 2 * 1 MIP peak mean, and so on). The values are used as initial guesses and are not fixed. |
| `gausParamsSigma`      | list of `float`  | `"3.0, 7.0"`              | The initial guesses for the MIP peak sigmas. Defaults to 5.0 for omitted peaks.                                                                                                                                                                                                                                                   |
| `fitRangeLow`          | `float`          | `11.0`                    | Lower limit of the fit                                                                                                                                                                                                                                                                                                            |
| `fitRangeHigh`         | `float`          | `35.0`                    | Upper limit of the fit                                                                                                                                                                                                                                                                                                            |
| `meanWarningsLow`      | list of `float`  | `""`                      | Lower warning thresholds for the MIP peak means                                                                                                                                                                                                                                                                                   |
| `meanWarningsHigh`     | list of `float`  | `""`                      | Upper warning thresholds for the MIP peak means                                                                                                                                                                                                                                                                                   |
| `meanErrorsLow`        | list of `float`  | `""`                      | Lower error thresholds for the MIP peak means                                                                                                                                                                                                                                                                                     |
| `meanErrorsHigh`       | list of `float`  | `""`                      | Upper error thresholds for the MIP peak means                                                                                                                                                                                                                                                                                     |
| `sigmaWarnings`        | list of `float`  | `""`                      | Sigma warning thresholds                                                                                                                                                                                                                                                                                                          |
| `sigmaErrors`          | list of `float`  | `""`                      | Sigma error thresholds                                                                                                                                                                                                                                                                                                            |
| `drawMeanWarningsLow`  | list of `bool`   | `"false, false"`          | Whether to draw the lower warning thresholds for the MIP peak means                                                                                                                                                                                                                                                               |
| `drawMeanWarningsHigh` | list of `bool`   | `"false, false"`          | Whether to draw the upper warning thresholds for the MIP peak means                                                                                                                                                                                                                                                               |
| `drawMeanErrorsLow`    | list of `bool`   | `"true, true"`            | Whether to draw the lower error thresholds for the MIP peak                                                                                                                                                                                                                                                                       |
| `drawMeanErrorsHigh`   | list of `bool`   | `"true, true"`            | Whether to draw the upper error thresholds for the MIP peak means                                                                                                                                                                                                                                                                 |
| `drawSigmaWarnings`    | list of `bool`   | `"false, false"`          | Whether to draw the sigma warning thresholds                                                                                                                                                                                                                                                                                      |
| `drawSigmaErrors`      | list of `bool`   | `"false, false"`          | Whether to draw the sigma error thresholds                                                                                                                                                                                                                                                                                        |
| `labelPos`             | list of `double` | `"0.15, 0.2, 0.85, 0.45"` | Position of the check label                                                                                                                                                                                                                                                                                                       |

#### Check logic

The check produces the worst quality it finds among the listed checks below. For each failed check, a quality flag is added to the quality that explains the problem.

For each peak (pseudo code):

- if the fit fails -> `quality = BAD`
- `if not (meanWarningLow < mean < meanWarningHigh)` -> `quality = MEDIUM`
- `if not (meanErrorLow < mean < meanErrorHigh)` -> `quality = BAD`
- `if not sigma < sigmaWarning` -> `quality = WARNING`
- `if not sigma < sigmaError` -> `quality = BAD`
